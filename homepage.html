<!-- homepage.html (Logged-in homepage) -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RentEasy • Welcome</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- NAVBAR -->
  <nav class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white shadow-md">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="homepage.html" class="text-2xl font-bold">RentEasy</a>
      <ul class="space-x-6 hidden md:flex">
        <li><a href="about.html" class="hover:text-indigo-200">About/FAQ</a></li>
        <li><a href="contact.html" class="hover:text-indigo-200">Support</a></li>
      </ul>
      <div id="auth-links" class="space-x-4">
        <a href="javascript:void(0);" id="dashboard-btn" class="px-4 py-2 border rounded hover:bg-gray-100">Go to Dashboard</a>
      </div>
    </div>
  </nav>

  <!-- HERO / SEARCH -->
  <header class="bg-white mt-6 shadow-lg">
    <div class="container mx-auto px-4 py-12 text-center">
      <h1 class="text-4xl font-extrabold text-gray-800 mb-4">Find Your Next Home</h1>
      <form id="search-form" class="max-w-2xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-4">
        <input type="text" id="search-location" placeholder="Location (city, barangay…)" 
              class="p-3 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-400">
        
        <select id="search-price" class="p-3 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-400">
          <option value="">Any Price</option>
          <option value="0-5000">₱0–₱5,000</option>
          <option value="5000-10000">₱5,000–₱10,000</option>
          <option value="10000+">₱10,000+</option>
        </select>
        
        <select id="search-type" class="p-3 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-400">
          <option value="">Any Type</option>
          <option value="apartment">Apartment</option>
          <option value="house">House</option>
          <option value="condo">Condo</option>
        </select>
        
        <button type="submit" 
                class="p-3 bg-indigo-600 text-white font-semibold rounded hover:bg-indigo-700">
          Search
        </button>
      </form>
      
    </div>
  </header>

  <!-- LISTING SECTION -->
  <section class="bg-white mt-10 py-10 shadow-inner">
    <div class="container mx-auto px-4 max-w-3xl">
      <h2 class="text-2xl font-bold mb-6 text-center text-indigo-700">Add New Property</h2>
      <form id="propertyForm" class="grid gap-4">
        <input type="text" placeholder="Property Name or Type (e.g. Condo, Apartment)" id="property-name" class="p-3 border rounded">
        <input type="text" placeholder="Location (City, Barangay, etc.)" id="property-location" class="p-3 border rounded">
      
        <div class="flex space-x-2">
          <div class="relative w-1/2">
            <span class="absolute inset-y-0 left-3 flex items-center text-gray-500 text-sm pointer-events-none">₱</span>
            <input 
              type="number" 
              inputmode="numeric" 
              pattern="\d*" 
              placeholder="Min" 
              id="price-min" 
              class="pl-7 p-3 border rounded w-full"
            >
          </div>
        
          <div class="relative w-1/2">
            <span class="absolute inset-y-0 left-3 flex items-center text-gray-500 text-sm pointer-events-none">₱</span>
            <input 
              type="number" 
              inputmode="numeric" 
              pattern="\d*" 
              placeholder="Max" 
              id="price-max" 
              class="pl-7 p-3 border rounded w-full"
            >
          </div>
        </div>
        
        <input type="text" placeholder="Image URL" id="property-image" class="p-3 border rounded">
        <!-- New Fields -->
        <input type="text" placeholder="Latitude" id="property-latitude" class="p-3 border rounded">
        <input type="text" placeholder="Longitude" id="property-longitude" class="p-3 border rounded">
        <input type="tel" 
          placeholder="User Contact (11-digit Number)" 
          id="user-contact" 
          class="p-3 border rounded" 
          pattern="^09[0-9]{9}$" 
          maxlength="11" 
          inputmode="numeric" 
          required>
        <small class="text-sm text-gray-500 ml-1">Format: 09123456789</small>
        <input type="text" placeholder="Social Media Links (Facebook, Instagram)" id="social-media" class="p-3 border rounded">
        
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold p-3 rounded">
          Add Listing
        </button>
      </form>
      
      <p id="submit-msg" class="mt-4 text-center text-green-600 hidden">Property added successfully!</p>
      <p id="error-msg" class="mt-2 text-center text-red-600 hidden">Please fill in all fields correctly.</p>
    </div>
  </section>

  <!-- DISPLAY PROPERTY LISTINGS -->
  <div class="text-center my-4">
    <button id="toggle-listings" class="bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 transition">
      Hide Listings
    </button>
  </div>
  <section class="bg-gray-50 py-10">
    <div class="container mx-auto px-4">
      <h2 class="text-2xl font-bold text-center mb-6 text-indigo-700">Your Available Properties</h2>
      <div id="property-listings" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Dynamically added property cards will go here -->
      </div>
    </div>
  </section>

 <!-- PUBLIC VIEW OF APPROVED PROPERTIES -->
 <section class="bg-gray-50 py-10">
  <div class="container mx-auto px-4">
    <h2 class="text-2xl font-bold text-center mb-6 text-indigo-700">Public Listings (Approved)</h2>
    <div id="approved-properties" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Dynamically added approved property cards will go here -->
    </div>
  </div>
</section>>

  <!-- FIREBASE + DISPLAY SCRIPT -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";
    import { query, where } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";
    import { onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    

    const firebaseConfig = {
      apiKey: "AIzaSyA5i8nbw8A4JDVUlJF3fZ7MIs9ed7S6fIc",
      authDomain: "rent4rent-e1e0b.firebaseapp.com",
      projectId: "rent4rent-e1e0b",
      storageBucket: "rent4rent-e1e0b.appspot.com",
      messagingSenderId: "467128925177",
      appId: "1:467128925177:web:b62c625847db1a18319b28",
      measurementId: "G-EJ0PL7CNQQ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
     

    const dashboardBtn = document.getElementById("dashboard-btn");
    dashboardBtn.addEventListener("click", () => {
      window.location.href = "dashboard.html";
    });

    const form = document.getElementById("propertyForm");
    const msg = document.getElementById("submit-msg");
    const errorMsg = document.getElementById("error-msg");
    form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("property-name").value.trim();
  const location = document.getElementById("property-location").value.trim();
  const minPrice = document.getElementById("price-min").value.trim();
  const maxPrice = document.getElementById("price-max").value.trim();
  const image = document.getElementById("property-image").value.trim();
  const latitude = document.getElementById("property-latitude").value.trim();
  const longitude = document.getElementById("property-longitude").value.trim();
  const userContact = document.getElementById("user-contact").value.trim();
  const socialMedia = document.getElementById("social-media").value.trim();


  if (!name || !location || !minPrice || !maxPrice || !image || !latitude || !longitude || !userContact || !socialMedia) {
    errorMsg.classList.remove("hidden");
    msg.classList.add("hidden");
    return;
  }

  const price = `₱${minPrice} – ₱${maxPrice}`;

  // Wait for auth state to be ready
  auth.onAuthStateChanged(async (user) => {
    const submittedBy = user ? user.email : "Unknown";

    try {
      // Add the property to Firestore with additional fields
      await addDoc(collection(db, "property"), {
        name,
        location,
        price,
        image,
        latitude,
        longitude,
        userContact,
        socialMedia,
        status: "In Review",
        createdAt: new Date(),
        submittedBy: auth.currentUser.email,
      });

      msg.classList.remove("hidden");
      errorMsg.classList.add("hidden");
      form.reset();

      // Reload properties to display the newly added one
      loadProperties();

      setTimeout(() => {
        msg.classList.add("hidden");
      }, 3000);
    } catch (err) {
      console.error("Error adding document: ", err);
    }
  });
});


    // Load properties
  const listingsContainer = document.getElementById("property-listings");
  async function loadProperties() {
  const user = auth.currentUser;
  if (!user) return;
  const userEmail = user.email;

  const q = query(collection(db, "property"), where("submittedBy", "==", userEmail));
  const querySnapshot = await getDocs(q);
  listingsContainer.innerHTML = "";

  querySnapshot.forEach((doc) => {
    const data = doc.data();

    const card = document.createElement("div");
    card.className = "bg-white rounded-lg shadow-md overflow-hidden";

    card.innerHTML = `
      <img src="${data.image}" alt="${data.name}" class="w-full h-48 object-cover">
      <div class="p-4">
        <h3 class="text-lg font-bold mb-1">${data.name}</h3>
        <p class="text-gray-600">${data.location}</p>
        <p class="text-indigo-600 font-semibold mt-2">${data.price}</p>

        <span class="inline-block mt-2 px-2 py-1 text-sm text-white ${getStatusBadgeColor(data.status)} rounded-full">${data.status}</span>

        ${data.latitude && data.longitude ? `
        <div class="mt-2 flex items-center text-blue-600 text-sm">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 12.414M12 3v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          <a href="https://www.google.com/maps?q=${data.latitude},${data.longitude}" target="_blank">View on Google Maps</a>
        </div>` : ''}

        ${data.userContact ? `
        <div class="mt-2 flex items-center text-gray-700 text-sm">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5h2l3 7-1.5 1.5a10 10 0 005 5L14 19l7-3v-2l-2-2-4 4-2-2 4-4-2-2H9L7 3H3v2z"/></svg>
          <span>${data.userContact}</span>
        </div>` : ''}

        ${data.socialMedia ? `
        <div class="mt-2 flex items-center text-indigo-700 text-sm">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 8a6 6 0 11-12 0 6 6 0 0112 0zm2 0h.01M12 14v6"></path></svg>
          <a href="${data.socialMedia}" target="_blank">Social Profile</a>
        </div>` : ''}
      </div>
    `;

    listingsContainer.appendChild(card);
  });
}

// PUBLIC VIEW - Approved Properties (Load once)
const publicApprovedContainer = document.getElementById("approved-properties");

async function loadApprovedPublicProperties() {
  try {
    const approvedQuery = query(collection(db, "property"), where("status", "==", "approved"));
    const querySnapshot = await getDocs(approvedQuery);
    publicApprovedContainer.innerHTML = "";

    querySnapshot.forEach((doc) => {
      const data = doc.data();

      const card = document.createElement("div");
      card.className = "bg-white rounded-lg shadow-md overflow-hidden";

      card.innerHTML = `
        <img src="${data.image}" alt="${data.name}" class="w-full h-48 object-cover">
        <div class="p-4">
          <h3 class="text-lg font-bold mb-1">${data.name}</h3>
          <p class="text-gray-600">${data.location}</p>
          <p class="text-indigo-600 font-semibold mt-2">${data.price}</p>

          <span class="inline-block mt-2 px-2 py-1 text-sm text-white bg-green-500 rounded-full">Approved</span>

          ${data.latitude && data.longitude ? `
          <div class="mt-2 flex items-center text-blue-600 text-sm">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 12.414M12 3v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            <a href="https://www.google.com/maps?q=${data.latitude},${data.longitude}" target="_blank">View on Google Maps</a>
          </div>` : ''}

          ${data.userContact ? `
          <div class="mt-2 flex items-center text-gray-700 text-sm">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5h2l3 7-1.5 1.5a10 10 0 005 5L14 19l7-3v-2l-2-2-4 4-2-2 4-4-2-2H9L7 3H3v2z"/></svg>
            <span>${data.userContact}</span>
          </div>` : ''}

          ${data.socialMedia ? `
          <div class="mt-2 flex items-center text-indigo-700 text-sm">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 8a6 6 0 11-12 0 6 6 0 0112 0zm2 0h.01M12 14v6"></path></svg>
            <a href="${data.socialMedia}" target="_blank">Social Profile</a>
          </div>` : ''}
        </div>
      `;

      publicApprovedContainer.appendChild(card);
    });
  } catch (error) {
    console.error("Error loading approved public properties:", error);
  }
}



function getStatusBadgeColor(status) {
  switch (status?.toLowerCase()) {
    case "approved":
      return "bg-green-500";
    case "rejected":
      return "bg-red-500";
    case "in review":
    default:
      return "bg-yellow-500";
  }
}


    // Load on page load
    loadApprovedPublicProperties();
    onAuthStateChanged(auth, (user) => {
  if (user) {
    loadProperties(); // only load after we’re sure the user is authenticated
  }
});
  </script>
  <!--- This section is not working fixing it tomorrow : )-->
  <script>
    const toggleButton = document.getElementById("toggle-listings");
    const listingsSection = document.querySelector("section.bg-gray-50");
  
    toggleButton.addEventListener("click", () => {
      if (listingsSection.style.display === "none") {
        listingsSection.style.display = "block";
        toggleButton.textContent = "Hide Listings";
      } else {
        listingsSection.style.display = "none";
        toggleButton.textContent = "Show Listings";
      }
    });
  </script>
  <script type="module">
    // Assuming this is after your listings are loaded
    const locationInput = document.getElementById('search-location');
    const priceSelect = document.getElementById('search-price');
    const typeSelect = document.getElementById('search-type');
    const propertyListings = document.getElementById('property-listings');
  
    // Popup for showing feedback (hidden initially)
    const popup = document.createElement('div');
    popup.id = 'filter-popup';
    popup.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded-md shadow-md opacity-0 pointer-events-none';
    popup.innerHTML = '<p>Filter Applied Successfully!</p>';
    document.body.appendChild(popup);
  
    function showFilterPopup() {
      // Show popup
      popup.classList.remove('opacity-0', 'pointer-events-none');
      popup.classList.add('opacity-100', 'pointer-events-auto');
  
      // Hide popup after 3 seconds
      setTimeout(() => {
        popup.classList.remove('opacity-100', 'pointer-events-auto');
        popup.classList.add('opacity-0', 'pointer-events-none');
      }, 3000);
    }
  
    function filterListings() {
  const location = locationInput.value.toLowerCase().trim();
  const priceRange = priceSelect.value;
  const type = typeSelect.value;

  const cards = propertyListings.querySelectorAll('.property-card');

  cards.forEach(card => {
    const cardLocation = card.dataset.location?.toLowerCase() || "";
    const cardName = card.dataset.name?.toLowerCase() || "";
    const cardPrice = parseInt(card.dataset.price);
    const cardType = card.dataset.type?.toLowerCase();

    let matches = true;

    // Match by location or name (whole word or contains)
    if (location) {
      const matchWord = new RegExp(`\\b${location}\\b`, 'i');
      if (!cardLocation.includes(location) && !cardName.includes(location) && !matchWord.test(cardName)) {
        matches = false;
      }
    }

    // Match by type
    if (type && cardType !== type) {
      matches = false;
    }

    // Match by price range
    if (priceRange) {
      if (priceRange === "0-5000" && !(cardPrice >= 0 && cardPrice <= 5000)) matches = false;
      if (priceRange === "5000-10000" && !(cardPrice > 5000 && cardPrice <= 10000)) matches = false;
      if (priceRange === "10000+" && cardPrice <= 10000) matches = false;
    }

    card.style.display = matches ? "block" : "none";
    card.classList.add("transition-all", "duration-300", "ease-in-out");
    card.style.opacity = matches ? 1 : 0;
  });


  
      // Log the search criteria and filtered results for testing
      console.log('Search Criteria:', { location, priceRange, type });
  
      // Show the popup
      showFilterPopup();
    }
  
    // Add event listeners for live filtering
    const searchForm = document.getElementById('search-form');
    searchForm.addEventListener('submit', (e) => {
      e.preventDefault(); // prevents redirect to search.html
      filterListings();   // manually trigger filter
    });
  
    [locationInput, priceSelect, typeSelect].forEach(input => {
      input.addEventListener('input', filterListings);
      input.addEventListener('change', filterListings);
    });
  </script>
  
  
</body>
</html>
